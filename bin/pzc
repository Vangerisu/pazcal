#!/bin/bash

PAZCAL_DIR=$HOME/pazcal
#PAZCAL_DIR=$HOME/Documents/pazcal

BIN_DIR=$PAZCAL_DIR/bin
INCLUDE_DIR=$PAZCAL_DIR/include

CXX=`which colorg++ 2> /dev/null` || CXX=g++
ALLOW="-Wno-dangling-else -Wno-sign-compare -Wno-writable-strings"
CXXFLAGS="-std=gnu++11 -Wall -Wextra -Werror $ALLOW -I $INCLUDE_DIR -include pazcal"

mktemp=`which mktemp`
if [ $? -eq 0 ]; then
    pzpdir=`$mktemp -d ${TMPDIR:-/tmp}/pzc.XXXXXXXX`
else
    pzpdir=${TMPDIR:-/tmp}/pzc.$RANDOM.$RANDOM.$RANDOM
    (umask 077 && mkdir $pzpdir)
fi

TMPDIR=$pzpdir ARGS=`$BIN_DIR/pzcheck $*` && \
    env CGCC_FORCE_COLOR=1 $CXX $CXXFLAGS $ARGS
result=$?

#rm -fr $pzpdir

exit $result
